# 스마트 계약 배포

import { RoutePath } from '@site/src/common/codesandbox'
import Editor from '@site/src/components/Editor'

<Editor module="/src/pages/viem-ext/fee-delegated-transaction/FeeDelegatedSmartContractDeploy.tsx" route={RoutePath.ViemExt_Fee_SmartContract_Deploy} />

**TxTypeSmartContractDeploy**는 지정된 주소에 스마트 컨트랙트를 배포합니다. 이 트랜잭션 유형에 따라 다음과 같은 변경 사항이 적용됩니다.

# 수수료 위임

<CH.Spotlight>
  <CH.Code>
    ```js TxTypeFeeDelegatedSmartContractDeploy.js
    import { http, createWalletClient, kairos, TxType, privateKeyToAccount } from "@kaiachain/viem-ext";

    const senderWallet = createWalletClient({
      chain: kairos,
      transport: http(),
      account: privateKeyToAccount(
        "0x0e4ca6d38096ad99324de0dde108587e5d7c600165ae4cd6c2462c597458c2b8"
      ),
    })
    const feePayerWallet = createWalletClient({
      chain: kairos,
      transport: http(),
      account: privateKeyToAccount(
        "0x9435261ed483b6efa3886d6ad9f64c12078a0e28d8d80715c773e16fc000cff4"
      ),
    });
    // Example usage
    (async () => {
      const tx = await senderWallet.prepareTransactionRequest({
        type: TxType.FeeDelegatedSmartContractDeploy,
        account: senderWallet.account,
        value: 0,
        humanReadable: false,
        codeFormat: 0,
        data: '0x608060405234801561001057600080fd5b5060f78061001f6000396000f3fe6080604052348015600f57600080fd5b5060043610603c5760003560e01c80633fb5c1cb1460415780638381f58a146053578063d09de08a14606d575b600080fd5b6051604c3660046083565b600055565b005b605b60005481565b60405190815260200160405180910390f35b6051600080549080607c83609b565b9190505550565b600060208284031215609457600080fd5b5035919050565b60006001820160ba57634e487b7160e01b600052601160045260246000fd5b506001019056fea2646970667358221220e0f4e7861cb6d7acf0f61d34896310975b57b5bc109681dbbfb2e548ef7546b364736f6c63430008120033',
      });
      const signedTx = await senderWallet.signTransaction(tx);
      console.log('signedTx', signedTx)
      const feePayerSignedTx = await feePayerWallet.signTransactionAsFeePayer(
        signedTx
      );
      const sentFeePayerTx = await feePayerWallet.request({
        method: "klay_sendRawTransaction",
        params: [feePayerSignedTx],
      });
      console.log("fee payer contract deploy tx", sentFeePayerTx);

    })();

    ```

    ---

    ```zsh output
    ❯ js TxTypeFeeDelegatedSmartContractDeploy.js
    signedTx 0x29f9018882095985066720b3008304125a808094a2a8854b1802d8cd5de631e690817c253d6a9153b90116608060405234801561001057600080fd5b5060f78061001f6000396000f3fe6080604052348015600f57600080fd5b5060043610603c5760003560e01c80633fb5c1cb1460415780638381f58a146053578063d09de08a14606d575b600080fd5b6051604c3660046083565b600055565b005b605b60005481565b60405190815260200160405180910390f35b6051600080549080607c83609b565b9190505550565b600060208284031215609457600080fd5b5035919050565b60006001820160ba57634e487b7160e01b600052601160045260246000fd5b506001019056fea2646970667358221220e0f4e7861cb6d7acf0f61d34896310975b57b5bc109681dbbfb2e548ef7546b364736f6c634300081200338080f847f8458207f6a0ef78ab459d0c14e7a7c9ddf4594d89a335479788af2d844d0d5ea0216be562fba042b0794cd2a5bedf23361ede5aa494fe4f5f79eb66c768678b27f992a6daadab
    fee payer contract deploy tx 0x8c07cbd99de8a0ff2b84bfb9c1a7e6729e93d03b86be7db091d7981e352f779f

    ```
  </CH.Code>

  ---

  웹3에서 카이아 기능을 추가하려면 **@kaiachain/viem-ext** 패키지를 가져옵니다.

  ```js TxTypeFeeDelegatedSmartContractDeploy.js focus=1:2
  ```

  ---

  카이로스 체인\*\*, **HTTP 전송**, 계정으로 변환된 **발신자의 개인 키**로 구성된 **createWalletClient**를 사용하여 발신자 및 수수료 납부자 지갑을 설정합니다.

  ```js TxTypeFeeDelegatedSmartContractDeploy.js focus=3:16
  ```

  ---

  발신자 계정, 수신자 주소, 전송할 값(이 예시에서는 0 KLAY), 트랜잭션 유형 **(TxType.FeeDelegatedSmartContractDeploy)**, **humanReadable: false**는 컨트랙트 코드가 사람이 읽을 수 있는 소스 코드가 아닌 바이트코드임을 지정하고 **codeFormat**는 스마트 컨트랙트 코드가 바이트코드로 된 트랜잭션 요청을 생성합니다: 0\*\*은 컨트랙트 코드의 형식(일반적으로 EVM 바이트코드)을 나타내고, **data**는 배포할 스마트 컨트랙트의 컴파일된 바이트코드를 포함합니다.

  ```js TxTypeFeeDelegatedSmartContractDeploy.js focus=19:26
  ```

  ---

  지갑 클라이언트의 **signTransaction** 메서드로 트랜잭션에 서명하고 트랜잭션 해시를 기록합니다.

  <CH.Code>
    ```js TxTypeFeeDelegatedSmartContractDeploy.js focus=27:28
    ```

    ---

    ```zsh output
    signedTx 0x29f9018882095985066720b3008304125a808094a2a8854b1802d8cd5de631e690817c253d6a9153b90116608060405234801561001057600080fd5b5060f78061001f6000396000f3fe6080604052348015600f57600080fd5b5060043610603c5760003560e01c80633fb5c1cb1460415780638381f58a146053578063d09de08a14606d575b600080fd5b6051604c3660046083565b600055565b005b605b60005481565b60405190815260200160405180910390f35b6051600080549080607c83609b565b9190505550565b600060208284031215609457600080fd5b5035919050565b60006001820160ba57634e487b7160e01b600052601160045260246000fd5b506001019056fea2646970667358221220e0f4e7861cb6d7acf0f61d34896310975b57b5bc109681dbbfb2e548ef7546b364736f6c634300081200338080f847f8458207f6a0ef78ab459d0c14e7a7c9ddf4594d89a335479788af2d844d0d5ea0216be562fba042b0794cd2a5bedf23361ede5aa494fe4f5f79eb66c768678b27f992a6daadab
    ```
  </CH.Code>

  ---

  수수료 납부자는 발신자가 이미 서명한 트랜잭션에 `signTransactionAsFeePayer` 함수를 사용하여 서명하고 트랜잭션 수수료를 지불하는 데 동의합니다.

  ```js TxTypeFeeDelegatedSmartContractDeploy.js focus=29:31
  ```

  ---

  완전히 서명된 수수료 위임 트랜잭션(발신자와 수수료 납부자 모두 서명)을 `kaia_sendRawTransaction` 메서드를 사용하여 카이로스 블록체인 네트워크에 전송하고 네트워크에서 트랜잭션 해시 또는 응답을 반환합니다.

  <CH.Code>
    ```js TxTypeFeeDelegatedSmartContractDeploy.js focus=32:36
    ```

    ---

    ```zsh output
    fee payer contract deploy tx 0x8c07cbd99de8a0ff2b84bfb9c1a7e6729e93d03b86be7db091d7981e352f779f

    ```
  </CH.Code>
</CH.Spotlight>
