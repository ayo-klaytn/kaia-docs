# 6. 고급 주제 및 FAQ

이 섹션에서는 고급 통합 기술, 모범 사례, 문제 해결 팁, Kaia의 가스 추상화(GA) 기능에 대해 자주 묻는 질문에 대해 설명합니다. 구현을 최적화하고 원활한 사용자 경험을 보장하고자 하는 개발자를 위해 설계되었습니다.

## 6.1 모범 사례

| 주제                 | 권장 사항                                                                                                                                                                                                                                                            | 참고                                                                                                                    |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| **미끄러짐**           | 토큰의 변동성이 크지 않은 한 `getAmountIn()`의 경우 \*\*0.5%(50bps)\*\*로 시작합니다.                                                                                                                                              | SDK는 값을 하드코딩하지 않으며, 카이아의 참조 코드에 표시된 0.5%가 사실상의 기본값입니다.                                |
| **수당**             | ERC-20 허용량을 캐시하고 '허용량 > 0'일 때 `ApproveTx`\*\*를 건너뛰어 추가 서명 및 가스를 피합니다.                                                                                                                                                                            | KIP-247은 이미 승인이 있는 경우 2-tx 번들(대여 + 스왑)을 허용하므로 허용량을 재사용하는 것은 완전히 안전합니다.             |
| **일괄 제출**          | 배열 페이로드인 `kaia_sendRawTransactions`를 사용하여 **ApproveTx + SwapTx**를 함께 푸시하여 풀 경합 조건을 방지합니다.                                                                                                                                                        | 단일 tx 호출(`eth_sendRawTransaction`)은 작동하지만 두 번째 tx가 먼저 노드에 도달하면 논스/정적 규칙 검사에 실패합니다. |
| **보안**             | a) Kaia 문서에서 표준 가스리스스왑라우터(GSR) 주소를 **하드코딩**합니다. <br/>b) 스왑을 빌드하기 전에 **지원을 확인**합니다(예: 시도/잡기 내에서 `await router.dexAddress(token)` 또는 `getSupportedTokens()`에서 반환된 목록을 확인합니다. | 피싱 계약이나 지원되지 않는 토큰이 GA 흐름을 가로채는 것을 방지합니다.                                                             |
| **KAIA가 없는 가스 추정** | 상태 오버라이드\*\*와 함께 `eth_estimateGas`를 사용하여 발신자에게 호출의 임시 잔액을 제공하세요(예: `eth_estimateGas(txObj, '최신', { [from]): { balance: '0x…' } })`.                                                                           | 계정에 실제로 KAIA가 0인 경우 _"잔액 부족"_ 오류를 우회합니다.                                                              |

## 6.2 문제 해결

| 증상                                                                 | 가능한 원인                                                                                                                                                  | 권장 수정 사항                                                                                                                                                                                                                      |
| ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **채굴되지 않은 번들**                                                     | a) '토큰' **화이트 리스트에 없음**. <br/>b) `minAmountOut`이 너무 빡빡하여 전체 번들이 되돌려집니다.                                                 | - 먼저 지원 여부 확인\*\*: `라우터.dexAddress(토큰)`(지원되지 않는 경우 되돌아감) **또는** `getSupportedTokens().includes(토큰)` **서명하기 전에**.<br/>- 미끄러짐 속도`를 높이거나 `금액\`을 적시에 다시 인용합니다. |
| **`INSUFFICIENT_OUTPUT_AMOUNT` 되돌리기**                              | 호가와 체결 사이에 가격이 변경되었으므로 '금액 수신 >= 최소 금액 출력' GSR 검사가 실패합니다.                                                                               | 현재 풀 보유량으로 `getAmountIn()`을 다시 실행한 다음 더 높은 `minAmountOut` 또는 더 넓은 슬리피지를 사용하여 `SwapTx`를 다시 빌드합니다.                                                                                                              |
| \*\*노드가 tx를 거부("자금 부족")\*\*합니다. | GaslessApproveTx\*\*만 전송되었습니다. 잔액 확인이 생략되고 페어링된 **SwapTx**가 누락되므로 제안자는 **LendTx**를 주입하지 않으며, 트랜잭션은 보유하지 않은 KAIA를 사용합니다. | 항상 `kaia_sendRawTransactions`를 통해 \*\*ApproveTx & SwapTx를 같은 묶음으로 제출하거나, 2-tx 번들을 보낼 수 있도록 `approveRequired == false`를 확인합니다.                                                             |
| **번들 내부 불일치 없음**                                                   | 외부 dApp은 GA 번들이 채굴되기 전에 다음 논스를 소비하는 일반 tx를 보냈습니다.                                                                                       | 서명 직전에 `getTransactionCount()`를 쿼리하고, 논스가 이동한 경우 두 tx 객체를 모두 다시 빌드합니다.                                                                                                                                        |
| `klay_sendRawTransactions → "정의되지 않은 tx 유형"`                       | 이더리움 유형만 지원하는 **kaia_…** 엔드포인트를 통해 카이아 전용 tx 유형(예: 0x30)을 일괄 전송하려고 했습니다.        | kia_sendRawTransactions`로 GA 번들을 전송한 다음 `klay_sendRawTransaction\`으로 0x30 AppTx를 브로드캐스트합니다.                                                                         |

## 6.3 자주 묻는 질문

### 메인넷에서 GA를 사용할 수 있나요?

예, GA는 현재 **카이로스 테스트넷**과 **메인넷** 모두에서 운영되고 있습니다.

### 사용자가 스왑에 필요한 토큰이 충분하지 않은 경우 어떻게 되나요?

스왑Tx는 온체인에서 실패하지만 **KIP-245의 원자 번들링**으로 인해 전체 번들이 되돌려지고 블록에서 제외됩니다. 사용자는 자금을 잃지 않으며, 온체인 상태는 변하지 않고 실패한 시도에 대해 가스 수수료를 전혀 지불하지 않습니다.

### 어떤 토큰이 얼마만큼 가스 교환되었는지 확인하려면 어떻게 해야 하나요?

성공한 모든 `swapForGas` 호출은 `GaslessSwapRouter`에서 **SwappedForGas** 이벤트를 발생시킵니다.\
할 수 있습니다:

1. KaiaScan에서 라우터 주소(계약 주소 문서 참조)를 조회하고 **이벤트** 탭을 엽니다.
2. 이벤트 로그에 표시된 '토큰', '금액인', '금액아웃', '금액환불' 필드를 디코딩합니다.

온체인 데이터가 필요한 경우, 인덱서 또는 dApp 백엔드에서 `SwappedForGas`를 확인하시기 바랍니다.

### 노드별로 GA를 비활성화할 수 있나요?

개별 노드에서 GA를 비활성화할 수 있지만 기본적으로 **활성화**되어 있습니다. 한 노드에서 이 기능을 비활성화하면 결국 트랜잭션은 GA를 지원하는 다른 노드에서 처리하게 됩니다.

### 가스 추상화는 블록 속도를 늦추나요?

아니요. KIP-245는 번들에 대해 블록당 250밀리초 _실행 시간 초과_ 검사를 면제하므로 EVM이 시작되면 전체 번들 처리를 완료할 수 있습니다. GA 트랜잭션은 잘 알려진 ERC20 승인 및 GSR 스왑 작업으로 제한되므로 합리적인 시간 동안 실행됩니다. 따라서 GA 번들은 체인의 블록 시간 예산을 위태롭게 하지 않습니다.

### 가스 없는 트랜잭션이 실제로 작동하는 모습을 어디에서 볼 수 있나요?

카이로스 테스트넷 탐색기에서 확인할 수 있습니다. 이 블록은 전체 번들이 연속적으로 실행되는 것을 보여줍니다:

- **3-tx 번들 예시(대출 + 승인 + 스왑):** [카이로스 카이아스캔에서 189826352 차단](https://kairos.kaiascan.io/block/189826352?tabId=blockTransactions&page=1)
- **2-tx 번들 예시(렌드 + 스왑):** [카이로스 카이아스캔에서 189826547 차단](https://kairos.kaiascan.io/block/189826547?tabId=blockTransactions)

## 6.4 추가 리소스

**기술 사양:**

- [KIP-247: 가스 없는 거래](https://kips.kaia.io/KIPs/kip-247) - 핵심 GA 사양
- [KIP-245: 트랜잭션 번들](https://kips.kaia.io/KIPs/kip-245) - 번들링 메커니즘
- [가스리스왑라우터 계약](https://github.com/kaiachain/kaia/blob/v2.0.3/contracts/contracts/system_contracts/kip247/GaslessSwapRouter.sol)

**개발자 리소스:**

- [Kaia SDK 리포지토리](https://github.com/kaiachain/kaia-sdk)
- [공식 계약 주소](https://docs.kaia.io/references/contract-addresses/)
- [카이아 개발자 문서](https://docs.kaia.io/)

**커뮤니티 및 지원:**

- [KIP-247 토론 포럼](https://devforum.kaia.io/t/discussion-on-kip-247/8089)
- [카이아 디스코드](https://discord.gg/kaiachain)
- [SDK 지원을 위한 깃허브 이슈](https://github.com/kaiachain/kaia-sdk/issues)

**교육 콘텐츠:**

- [스테이블코인으로 가스 요금을 지불할 수 있다면 어떨까요?](https://medium.com/kaiachain/pay-for-gas-fees-with-any-token-a-deep-dive-into-kaias-trustless-gas-abstraction-d670355a096b)
- [카이아 컨센서스 유동성 발표](https://medium.com/kaiachain/kaia-consensus-liquidity-a-new-paradigm-in-blockchain-liquidity-7c8a7393cd19)